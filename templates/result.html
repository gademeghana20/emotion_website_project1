<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>{{ emotion|capitalize }} Mood</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body class="result-page">

  <div id="click-tip">Click anywhere to start music 🎵</div>


  {% if emotion != "unknown" %}
  <!-- Background Video -->
  <video id="bg-video" autoplay loop muted playsinline>
    <source src="{{ url_for('static', filename='videos/' + emotion + '.mp4') }}" type="video/mp4" />
  </video>

  <!-- Background Music -->
  <audio id="bg-audio" loop>
    <source src="{{ url_for('static', filename='music/' + emotion + '.mp3') }}" type="audio/mpeg" />
  </audio>
  {% endif %}

  <!-- Top-right control (Back only) -->
  <div class="corner-controls">
    <button id="back-btn">Back</button>
  </div>

  <!-- Overlay content -->
  <div class="overlay">
    <h1>{{ emotion|capitalize }} Mood</h1>

    <div class="quote-window">
      <div class="quote-track" id="quote-track">
        {% for q in quotes %}
          <p class="quote">{{ q }}</p>
        {% endfor %}
        {% for q in quotes %}
          <p class="quote">{{ q }}</p>
        {% endfor %}
      </div>
    </div>
  </div>

  <script src="{{ url_for('static', filename='js/script.js') }}"></script>

  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const audio = document.getElementById("bg-audio");
    const video = document.getElementById("bg-video");

    // Autoplay muted video
    if (video) {
      video.muted = true;
      video.play().catch(() => {});
    }

    // Prepare muted audio
    if (audio) {
      audio.muted = true;
      audio.load();
    }

    // Enable audio after first click
    const enableSound = () => {
      if (audio) {
        audio.muted = false;
        audio.volume = 1.0;
        audio.play().then(() => console.log("✅ Music started")).catch(err => console.log("❌ Audio play error:", err));
      }
      if (video) {
        video.muted = false;
        video.play().catch(() => {});
      }
      document.removeEventListener("click", enableSound);
    };

    document.addEventListener("click", enableSound);
  });

  // Hide click-tip overlay after first click
  document.addEventListener("click", () => {
    const overlay = document.getElementById("click-tip");
    if (overlay) {
      overlay.style.display = "none";
    }
  }, { once: true });
  </script>

</body>
</html>

